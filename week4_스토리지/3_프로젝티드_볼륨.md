PV/PVC는 `거대한 외장 하드를 가져오는 것`이었다면, 프로젝티드 볼륨은 `여러 개의 작은 파일들을 한 폴더에 모아서 보여주는 것`이다.

```
📝 Secret (API 키)           }
📝 ConfigMap (설정 파일)       }  → 📂 /etc/config/
📝 Downward API (Pod 정보)    }     (하나의 폴더에 모임)
📝 ServiceAccount Token      }
```

작은 텍스트 파일들(쿠버네티스 내부 리소스)을 모아서 파일처럼 보이게 한다.

하나씩 알아보자.

---

### 프로젝티드 볼륨(Projected Volumes)이란?

> "여러 소스(Source)를 하나의 디렉토리에 쏘아준다(Project)"는 뜻이다.

- **기존 방식**
  - 설정 파일은 `ConfigMap` 볼륨으로 `/etc/config`에 마운트.
  - 비밀번호는 `Secret` 볼륨으로 `/etc/secret`에 마운트.
  - 파드 정보는 `DownwardAPI` 볼륨으로 `/etc/podinfo`에 마운트.
  - *결과:* 마운트 경로가 너무 많아지고 관리가 복잡해집니다.
- **프로젝티드 볼륨 방식**
  - `ConfigMap`, `Secret`, `DownwardAPI`를 **모두 합쳐서** `/projected-data`라는 **하나의 경로**에 파일들로 쫙 깔아준다.
  - 마치 빔 프로젝터가 여러 영상을 하나의 스크린에 비춰주는 것과 같다.

---

### 무엇을 합칠 수 있나?

> 프로젝티드 볼륨은 다음 **4가지 소스**를 하나의 볼륨으로 묶을 수 있다.

1. **Secret:** 비밀번호, 키 등 보안 데이터
2. **ConfigMap:** 설정 파일
3. **DownwardAPI:** 파드 자신의 정보 (파드 이름, IP, CPU 제한량 등)
4. **ServiceAccountToken:** 쿠버네티스 API 서버와 통신하기 위한 인증 토큰

---

### YAML

> 개발자는 `sources` 리스트 아래에 합치고 싶은 것들을 쭉 나열하면 된다.

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: volume-test
spec:
  containers:
    - name: container-test
      image: busybox
      volumeMounts:
        - name: all-in-one # 하나의 볼륨만 마운트하면 됨
          mountPath: "/projected-volume"
          readOnly: true
  volumes:
    - name: all-in-one
      projected: # [핵심 키워드]
        sources: # 여기에 합칠 재료들을 나열
          - secret:
              name: mysecret
              items:
                - key: username
                  path: my-username
          - configMap:
              name: myconfigmap
              items:
                - key: config
                  path: my-config
          - downwardAPI:
              items:
                - path: "labels"
                  fieldRef:
                    fieldPath: metadata.labels
```

컨테이너 내부의 `/projected-volume` 폴더에 들어가면 `my-username`, `my-config`, `labels` 파일이 모두 모여 있게 된다.

---

### 왜 씀?

> 사실 ConfigMap이나 Secret을 합치는 건 "편의성" 때문이지만, 프로젝티드 볼륨이 **필수적**으로 쓰이는 이유는 **`ServiceAccountToken`의 보안성** 때문이다.

- **과거의 방식:** 파드가 생성될 때 시크릿(Secret) 형태로 토큰을 영구적으로 마운트했다.
- **프로젝티드 볼륨 방식:** `serviceAccountToken` 소스를 사용하면 토큰의 만료 시간(expirationSeconds)을 설정할 수 있고, 자동으로 순환(Rotation)된다.
  - 쉽게 말해, 은행 OTP처럼 시간이 지나면 바뀌는 안전한 토큰을 파드에 파일 형태로 계속 갱신해 준다.
