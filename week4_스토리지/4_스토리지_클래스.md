## Static provisioning

- **Kubernetes Volume**
    
    Pod의 구성요소로 Pod spec에서 정의되는 스토리지 
    
    - Pod와 생명주기가 같기 때문에 Pod가 죽으면 데이터도 같이 사라진다.
    - 매번 Pod를 만들 때 Volume을 전부 정의해야 한다.
- **PersistentVolume(PV)**
    
    Volume을 한번에 관리하기 위해 만들어진 개념으로 관리자가 미리 큰 저장소 풀(스토리지 리소스)을 생성해두는 형태
    
    - 여러 Pod가 필요할 때마다 가져다 쓸 수 있는 클러스터 레벨 저장소
    - Pod의 생명주기와는 무관하게 유지된다.
- **PersistentVolumeClaim(PVC)**
    
    사용자가 PV를 빌려쓰기 위해 작성하는 요청서(청구서) 
    
    - 얼마나 어떤 형태로 스토리지를 사용하려고하는지를 작성해서 PV를 요청한다.
    - PVC를 받으면 쿠버네티스가 PVC 요구사항에 맞는 PV를 찾아 연결한다.

위와 같은 방식은 관리자가 PV를 만들어두고 → 사용자가 PVC를 만들어서 요청하고 → Pos spec에서 해당 PVC를 명시하는 3가지 단계가 필요하다.

## Storage Class

Storage class는 pvc가 만들어질 때 PV를 자동으로 생성하고 싶은 경우 사용한다. → Storage 클래스를 사용하는데 가장 핵심 목적이 Dynamic provisioning

```yaml
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
name: standard
provisioner: kubernetes.io/aws-ebs
parameters:
type: gp2
reclaimPolicy: Retain
allowVolumeExpansion:truemountOptions:
  - debug
volumeBindingMode: Immediate
```

- StorageClass가 존재하면 PVC가 생성되자마자 쿠버네티스가 자동으로 PV를 생성해준다. → Dynamic provisioning
- 서로 다른 유형의 스토리지를 제공하고 싶을 때, 쿠버네티스에서 클래스로 구분해서 PVC가 선택할 수 있도록한다.
    
    쿠버네티스는 이 클래스가 무엇을 의미하는지 내부적으로 신경쓰지 않는다. 
    
- 주요 필드: 스토리지의 설정 묶음(프로파일)을 정의한다.
    - provisioner: 어떤 스토리지 플러그인을 사용해 volume을 생성할지 선택
        - AWSElasticBlockSotre
        - AzureFile
        - AzureDisk
        
        등
        
    - parameters: 해당 스토리지 클래스가 생성하는 볼륨에 대한 상세 옵션
        
        스토리지 클래스에 속하는 볼륨을 설명하는 파라미터 → provisioner에 따른 다른 파라미터를 사용할 수 있다. 
        
    - reclaimPolicy: PVC가 끝났을 때 PV가 어떻게 처리될지 결정
        - Delete
        - Retain
    - allowVolumeExpansion: Volume 크기를 확장할지 여부
        - True로 설정되어있으면, 해당 PVC 오브젝트를 편집해 볼륨 크기를 조정할 수 있다.
    - volumeBindingMode: Volume binding 시점을 제어하는 옵션
        
        Volume binding과 dynamic provisioning의 시작 시기를 제어한다. 
        
    - mountOptions: 생성된 Volume에 마운트할 때 적용할 옵션을 지정